<!-- templates/simple_index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Anime Search</title>
    <style>
        #searchInput { width: 100%; padding: 10px; margin: 20px 0; }
        #searchResults { border: 1px solid #ccc; max-height: 300px; overflow-y: auto; }
        .result-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .result-item:hover { background: #f0f0f0; }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>
<body>
    <h1>Anime Recommender System</h1>
    <div class="container">
        <div class="col-md-6 border border-5 rounded p-3">
            <h1>Anime Search</h1>
            <input type="text" id="searchInput" placeholder="Search anime...">
            <div id="searchResults"></div>

            <script>
                // Search functionality
                document.getElementById('searchInput').addEventListener('input', function(e) {
                    const query = e.target.value.trim();
                    if (query.length < 2) {
                        document.getElementById('searchResults').innerHTML = '';
                        return;
                    }
                    
                    fetch(`/search?q=${encodeURIComponent(query)}`)
                        .then(r => r.json())
                        .then(results => {
                            const html = results.map(anime => 
                                `<div class="result-item" data-anime-id="${anime.anime_id}">${anime.name}</div>`
                            ).join('');
                            document.getElementById('searchResults').innerHTML = html;
                        });
                });

                // Handle clicks on search results
                document.getElementById('searchResults').addEventListener('click', function(e) {
                    if (e.target.classList.contains('result-item')) {
                        const anime_id = e.target.getAttribute('data-anime-id');
                        fetchAnimeDetails(anime_id);
                    }
                });

                // Fetch anime details through your backend proxy
                async function fetchAnimeDetails(anime_id) {
                    if (!anime_id) return;
                    
                    try {
                        console.log('Fetching details for anime ID:', anime_id);
                        
                        const response = await fetch(`/api/anime/${anime_id}`);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        const result = await response.json();
                        
                        // Make sure the element exists before trying to update it
                        const resultElement = document.getElementById('result');
                        if (resultElement) {
                            resultElement.innerText = 'Prediction: ' + JSON.stringify(result, null, 2);
                        } else {
                            console.error('Element with id "result" not found');
                            // Create the element or show alert
                            alert('Anime details: ' + JSON.stringify(result, null, 2));
                        }

                    } catch (error) {
                        console.error('Error:', error);
                        
                        const resultElement = document.getElementById('result');
                        if (resultElement) {
                            resultElement.innerText = 'An error occurred while fetching anime details.';
                        } else {
                            console.error('Error and result element not found');
                        }
                    }
                }
            </script>

            <div id="selectedAnime">
                <div id="result"></div>

            </div>
        </div>
    </div>
</body>
</html>